<script type="text/javascript">
    function validate(name) {
        return function () {
            if (this[name] == null || this[name] == "") {
                if (name == "entities" && this.inputfield != null) {
                    this[name] = this.inputfield; return true;
                    this[name + "type"] = "msg";
                }
                return false;
            }
            return RED.validators.typedInput(name);
        }
    }
</script>
<script type="text/x-red" data-template-name="api-credentials">
    <div class="form-row">
        <label><i class="icon-bookmark"></i> Username</label>
        <input type="text" id="node-config-input-username">
    </div>
    <div class="form-row">
        <label><i class="icon-bookmark"></i> Password</label>
        <input type="text" id="node-config-input-password" style="-webkit-text-security: disc;">
    </div>
    <div class="form-row">
        <label ><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Node name">
    </div>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api-credentials', {
        category: 'config',
        defaults: {
            name: { value: "" }
        },
        credentials: {
            username: { type: "text" },
            password: { type: "password" }
        },
        label: function () {
            return this.name || "api credentials";
        }
    });
</script>


<script type="text/x-red" data-template-name="api get jwt">
    <!-- readonly onfocus="this.removeAttribute('readonly');" autocomplete="off" -->
<div class="form-row">
    <label for="node-input-config"><i class="fa fa-globe"></i> Config</label>
    <input type="text" id="node-input-config">
</div>
<div class="form-row">
    <label><i class="fa fa-tag"></i> Refresh existing</label>
    <input type="checkbox" id="node-input-refresh" style="width: auto;">
</div>
<div class="form-row">
    <label><i class="fa fa-tag"></i> Create long token</label>
    <input type="checkbox" id="node-input-longtoken" style="width: auto;">
</div>
<div class="form-row">
    <label><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Node name">
</div>
</script>
<script type="text/x-red" data-help-name="api get jwt">
Request a JWT token for talking with API. Leave config blank to impersonate root.
</script>
<script type="text/javascript">
    RED.nodes.registerType('api get jwt', {
        category: 'api',
        color: "#FFAAAA",
        paletteLabel: 'get jwt',
        icon: "font-awesome/fa-key",
        defaults: {
            name: { value: "" },
            config: { value: "", type: "api-credentials", required: false },
            refresh: { value: false, type: "boolean" },
            longtoken: { value: false, type: "boolean" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "get jwt";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

    });
</script>







<script type="text/x-red" data-template-name="api get">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Query</label>
        <input type="hidden" id="node-input-querytype">
        <input style="width:70%" type="text" id="node-input-query" placeholder="Mongo Query">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Projection</label>
        <input type="hidden" id="node-input-projectiontype">
        <input style="width:70%" type="text" id="node-input-projection" placeholder="Projection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection" placeholder="Collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Result to</label>
        <input type="hidden" id="node-input-resultfieldtype">
        <input style="width:70%" type="text" id="node-input-resultfield" placeholder="Save result to this field"">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Orderby</label>
        <input type="hidden" id="node-input-orderbytype">
        <input style="width:70%" type="text" id="node-input-orderby" placeholder="Order result by this property">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Top</label>
        <input type="hidden" id="node-input-toptype">
        <input style="width:70%" type="text" id="node-input-top" placeholder="Limit number of results">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Skip</label>
        <input type="hidden" id="node-input-skiptype">
        <input style="width:70%" type="text" id="node-input-skip" placeholder="Skip a number of results">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api get">
    <p>Get items from a collection, based on a Mongo <a href="https://docs.mongodb.com/manual/reference/method/db.collection.find/" target="_blank">query</a></p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api get', {
        category: 'api',
        color: "#DEB887",
        paletteLabel: 'get',
        icon: "font-awesome/fa-database",
        defaults: {
            name: { value: "" },
            query: { value: "", validate: validate("querytype") },
            querytype: { value: "" },
            projection: { value: "", validate: validate("projectiontype") },
            projectiontype: { value: "" },
            top: { value: 500, validate: validate("toptype"), required: true },
            toptype: { value: "" },
            skip: { value: 0, validate: validate("skiptype"), required: true },
            skiptype: { value: "" },
            collection: { value: "entities", validate: validate("collectiontype"), required: true },
            collectiontype: { value: "" },
            resultfield: { value: "payload", validate: validate("resultfieldtype"), required: true },
            resultfieldtype: { value: "" },
            orderby: { value: "" },
            orderbytype: { value: "" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api get";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-query").typedInput({
                default: 'str',
                typeField: $("#node-input-querytype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-projection").typedInput({
                default: 'str',
                typeField: $("#node-input-projectiontype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-orderby").typedInput({
                default: 'str',
                typeField: $("#node-input-orderbytype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-top").typedInput({
                default: 'num',
                typeField: $("#node-input-toptype"),
                types: ['msg', 'num', 'flow', 'global']
            });
            $("#node-input-skip").typedInput({
                default: 'num',
                typeField: $("#node-input-skiptype"),
                types: ['msg', 'num', 'flow', 'global']
            });
            $("#node-input-resultfield").typedInput({
                default: 'msg',
                typeField: $("#node-input-resultfieldtype"),
                types: ['msg']
            });

        }
    });

</script>





<script type="text/x-red" data-template-name="api add">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Type</label>
        <input type="hidden" id="node-input-entitytypetype">
        <input style="width:70%" type="text" id="node-input-entitytype" placeholder="Override new entity type">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Entities</label>
        <input type="hidden" id="node-input-entitiestype">
        <input style="width:70%" type="text" id="node-input-entities">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Write Concern</label>
        <select id="node-input-writeconcern">
            <option value="0">Requests no acknowledgment</option>
            <option value="majority">Requests majority</option>
            <option value="1">Requests acknowledgment from 1</option>
            <option value="2">Requests acknowledgment from 2</option>
            <option value="3">Requests acknowledgment from 3</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Journal</label>
        <select id="node-input-journal">
            <option value="false">In memory</option>
            <option value="true">Written to the journal</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api add">
    <p>Add payload as new entity in collection, can be an object or array of objects, returns an array of results</p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api add', {
        category: 'api',
        color: "#DEBD5C",
        paletteLabel: 'add',
        icon: "font-awesome/fa-plus",
        defaults: {
            name: { value: "" },
            writeconcern: { value: "0", required: true },
            journal: { value: "false", required: true },
            collection: { value: "entities", validate: validate("collection") },
            collectiontype: { value: "" },
            entitiestype: { value: "" },
            entities: { value: "payload", validate: validate("entities") },
            entitytype: { value: "" },
            entitytypetype: { value: "" },

            resultfield: { value: "" },
            inputfield: { value: "" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api add";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

        oneditprepare: function () {
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-entitytype").typedInput({
                default: 'str',
                typeField: $("#node-input-entitytypetype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-entities").typedInput({
                default: 'msg',
                typeField: $("#node-input-entitiestype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
        },

    });

</script>



<script type="text/x-red" data-template-name="api add many">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Type</label>
        <input type="hidden" id="node-input-entitytypetype">
        <input style="width:70%" type="text" id="node-input-entitytype">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Entities</label>
        <input type="hidden" id="node-input-entitiestype">
        <input style="width:70%" type="text" id="node-input-entities">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Write Concern</label>
        <select id="node-input-writeconcern">
            <option value="0">Requests no acknowledgment</option>
            <option value="majority">Requests majority</option>
            <option value="1">Requests acknowledgment from 1</option>
            <option value="2">Requests acknowledgment from 2</option>
            <option value="3">Requests acknowledgment from 3</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Journal</label>
        <select id="node-input-journal">
            <option value="false">In memory</option>
            <option value="true">Written to the journal</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Skip results</label>
        <input type="checkbox" id="node-input-skipresults" style="width: auto;">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api add many">
    <p>Add payload as new entity in collection, can be an object or array of objects, returns an array of results</p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api add many', {
        category: 'api',
        color: "#DEBD5C",
        paletteLabel: 'add many',
        icon: "font-awesome/fa-plus",
        defaults: {
            name: { value: "" },
            collection: { value: "entities", validate: validate("collection"), required: true },
            collectiontype: { value: "" },
            entitytype: { value: "" },
            inputfield: { value: "" },
            entitytypetype: { value: "" },
            entities: { value: "payload", validate: validate("entities"), required: true },
            entitiestype: { value: "" },
            writeconcern: { value: "0", required: true },
            journal: { value: "false", required: true },
            skipresults: { value: false, required: true },

            resultfield: { value: "" },
            inputfield: { value: "" },

        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api add many";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

        oneditprepare: function () {
            $("#node-input-entitytype").typedInput({
                default: 'str',
                typeField: $("#node-input-entitytypetype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-entities").typedInput({
                default: 'msg',
                typeField: $("#node-input-entitiestype"),
                types: ['msg', 'json']
            });
        },

    });

</script>

<script type="text/x-red" data-template-name="api update">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Type</label>
        <input type="hidden" id="node-input-entitytypetype">
        <input style="width:70%" type="text" id="node-input-entitytype" placeholder="Override _type">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection" placeholder="Collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Entities</label>
        <input type="hidden" id="node-input-entitiestype">
        <input style="width:70%" type="text" id="node-input-entities">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Write Concern</label>
        <select id="node-input-writeconcern">
            <option value="0">Requests no acknowledgment</option>
            <option value="majority">Requests majority</option>
            <option value="1">Requests acknowledgment from 1</option>
            <option value="2">Requests acknowledgment from 2</option>
            <option value="3">Requests acknowledgment from 3</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Journal</label>
        <select id="node-input-journal">
            <option value="false">In memory</option>
            <option value="true">Written to the journal</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api update">
    <p>Update payload in database, payload can be an object or array of objects, returns an array of results</p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api update', {
        category: 'api',
        color: "#E2D96E",
        paletteLabel: 'update',
        icon: "font-awesome/fa-pencil",
        defaults: {
            name: { value: "" },
            entitytype: { value: "", validate: validate("entitytypetype") },
            entitytypetype: { value: "" },
            collection: { value: "entities", validate: validate("collectiontype"), required: true },
            collectiontype: { value: "" },
            entities: { value: "payload", validate: validate("entities"), required: true },
            entitiestype: { value: "" },
            writeconcern: { value: "0", required: true },
            journal: { value: "false", required: true },

            inputfield: { value: "" },
            resultfield: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api update";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

        oneditprepare: function () {
            $("#node-input-entitytype").typedInput({
                default: 'str',
                typeField: $("#node-input-entitytypetype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-entities").typedInput({
                default: 'msg',
                typeField: $("#node-input-entitiestype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
        },

    });

</script>



<script type="text/x-red" data-template-name="api addorupdate">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Type</label>
        <input type="hidden" id="node-input-entitytypetype">
        <input style="width:70%" type="text" id="node-input-entitytype" placeholder="Override new entity type">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Uniqeness</label>
        <input type="hidden" id="node-input-uniqenesstype">
        <input style="width:70%" type="text" id="node-input-uniqeness" placeholder="Comma list of fields to compare by">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Entities</label>
        <input type="hidden" id="node-input-entitiestype">
        <input style="width:70%" type="text" id="node-input-entities">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Write Concern</label>
        <select id="node-input-writeconcern">
            <option value="0">Requests no acknowledgment</option>
            <option value="majority">Requests majority</option>
            <option value="1">Requests acknowledgment from 1</option>
            <option value="2">Requests acknowledgment from 2</option>
            <option value="3">Requests acknowledgment from 3</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Journal</label>
        <select id="node-input-journal">
            <option value="false">In memory</option>
            <option value="true">Written to the journal</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api addorupdate">
    <p>
        Add or Update an item og array of items in data.<br />
        Checks for uniqeness based on _id. If uniqeness should be checked agains other fields, supply them in the uniqeness field.
        To check on more than one field, seperate fields with comma.<br>
        Returns an array of results
    </p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api addorupdate', {
        category: 'api',
        color: "#E6E0F8",
        paletteLabel: 'addorupdate',
        icon: "font-awesome/fa-pencil",
        defaults: {
            name: { value: "" },
            writeconcern: { value: "0", required: true },
            journal: { value: "false", required: true },
            entitytype: { value: "", validate: validate("entitytypetype") },
            entitytypetype: { value: "" },
            collection: { value: "entities", validate: validate("collectiontype"), required: true },
            collectiontype: { value: "" },
            entities: { value: "payload", validate: validate("entities"), required: true },
            entitiestype: { value: "" },
            uniqeness: { value: "", validate: validate("uniqenesstype") },
            uniqenesstype: { value: "" },

            resultfield: { value: "" },
            inputfield: { value: "" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api addorupdate";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

        oneditprepare: function () {
            $("#node-input-entitytype").typedInput({
                default: 'str',
                typeField: $("#node-input-entitytypetype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-entities").typedInput({
                default: 'msg',
                typeField: $("#node-input-entitiestype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-uniqeness").typedInput({
                default: 'str',
                typeField: $("#node-input-uniqenesstype"),
                types: ['msg', 'str', 'flow', 'global']
            });

        },

    });

</script>





<script type="text/x-red" data-template-name="api delete">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection" placeholder="Collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Entities</label>
        <input type="hidden" id="node-input-entitiestype">
        <input style="width:70%" type="text" id="node-input-entities">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api delete">
    <p>Deletes payload from database. Payload can be a string with the id, or an object with an _id field, or an array of text/objects</p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api delete', {
        category: 'api',
        color: "#E9967A",
        paletteLabel: 'delete',
        icon: "font-awesome/fa-trash",
        defaults: {
            name: { value: "" },
            collection: { value: "entities", validate: validate("collection"), required: true },
            collectiontype: { value: "" },
            entities: { value: "payload", validate: validate("entities"), required: true },
            entitiestype: { value: "" },

            resultfield: { value: "" },
            inputfield: { value: "" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api delete";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-entities").typedInput({
                default: 'msg',
                typeField: $("#node-input-entitiestype"),
                types: ['msg']
            });
        },
    });
</script>




<script type="text/x-red" data-template-name="api delete many">
    <div class="form-row">
        <label><i class="fa fa-list"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Query</label>
        <input type="hidden" id="node-input-querytype">
        <input style="width:70%" type="text" id="node-input-query">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api delete many">
    <p>Deletes payload from database. <br>
        Query can either be an array of objects ( with an _id ) to delete, or a string/object query to delete.
        Collection is the collection to query and delete from.
        </p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api delete many', {
        category: 'api',
        color: "#E9967A",
        paletteLabel: 'delete many',
        icon: "font-awesome/fa-trash",
        defaults: {
            name: { value: "" },
            query: { value: "query", validate: validate("querytype"), required: true },
            querytype: { value: "" },
            collection: { value: "entities", validate: validate("collectiontype"), required: true },
            collectiontype: { value: "" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "delete many";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

        // https://nodered.org/docs/api/ui/typedInput/
        oneditprepare: function () {
            $("#node-input-query").typedInput({
                default: 'msg',
                typeField: $("#node-input-querytype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global']
            });
        }
    });
</script>




<script type="text/x-red" data-template-name="grant permission">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label ><i class="fa fa-tag"></i> Target</label>
        <input type="text" id="node-lookup-targetid" placeholder="Leave empty, to get from msg.targetid ">
        <input type="hidden" id="node-input-targetid">
    </div>
    <div class="form-row">
        <label for="node-input-typed-entities"><i class="fa fa-list"></i> Entities</label>
        <input id="node-input-typed-entities" type="text" style="width: 70%">
        <input id="node-input-entities" type="hidden">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Bitsexplained </label>
        (F:-1, R:2, U:3, D:4, I:5)
    </div>
    <div class="form-row">
        <label for="node-input-bits"><i class="fa fa-tag"></i> Bits </label>
        <input type="text" id="node-input-bits" placeholder="Bits seperated by comma,">
    </div>
</script>
<script type="text/x-red" data-help-name="grant permission">
    <p>Grants a role (or user if set by msg.targetid) a specific permission on the entity/entities in payload.</p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('grant permission', {
        category: 'api',
        color: "#A6BBCF",
        paletteLabel: 'grant',
        icon: "font-awesome/fa-key",
        defaults: {
            name: { value: "" },
            targetid: { value: "" },
            entities: { value: "payload", required: true },
            bits: { value: "", required: true }
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "grant permission";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

        oneditprepare: function () {
            $("#node-input-typed-entities").typedInput({ types: ['msg'] });
            $("#node-input-typed-entities").typedInput('value', this.entities);


            try {
                $("#node-lookup-targetid").autocomplete("destroy");
            } catch (error) {
            }
            var targetidvalues = [];
            $.getJSON('api_userroles', function (data) {
                targetidvalues.push({
                    value: null,
                    label: "from msg.targetid"
                })
                $.each(data, function (i, ele) {
                    targetidvalues.push({
                        id: ele._id,
                        value: ele.name,
                        label: ele.name
                    })
                    if (ele._id == $("#node-input-targetid").val()) {
                        $("#node-lookup-targetid").val(ele.name);

                    }
                });
            });
            $("#node-lookup-targetid").focus(() => {
                $("#node-lookup-targetid").autocomplete("search", $("#node-lookup-targetid").val());
            })
            $("#node-lookup-targetid").autocomplete({
                source: targetidvalues,
                minLength: 0,
                source: function (request, response) {
                    var val = $('#node-lookup-targetid').val();
                    $.getJSON('api_userroles', { name: val }, function (data) {
                        var matches = [];
                        $.each(data, function (i, ele) {
                            matches.push({
                                id: ele._id,
                                value: ele._id,
                                label: ele.name,
                                i: i
                            })
                        });
                        response(matches);
                    });
                },

                select: function (event, ui) {
                    $("#node-input-targetid").val(ui.item.id);
                    $("#node-lookup-targetid").val(ui.item.label);
                    return false; // Prevent the widget from inserting the value.
                },
                close: function (event, ui) {
                    $.each(targetidvalues, function (i, ele) {
                        if (ele.id == $("#node-input-targetid").val()) {
                            $("#node-lookup-targetid").val(ele.label);
                        }
                    });
                },
            });

        },
        oneditsave: function () {
            $("#node-input-entities").val($("#node-input-typed-entities").typedInput('value'));
        }

    });
</script>







<script type="text/x-red" data-template-name="revoke permission">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label ><i class="fa fa-tag"></i> Target</label>
        <input type="text" id="node-lookup-targetid" placeholder="Leave empty, to get from msg.targetid ">
        <input type="hidden" id="node-input-targetid">
    </div>
    <div class="form-row">
        <label for="node-input-typed-entities"><i class="fa fa-list"></i> Entities</label>
        <input id="node-input-typed-entities" type="text" style="width: 70%">
        <input id="node-input-entities" type="hidden">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Bitsexplained </label>
        (F:-1, R:2, U:3, D:4, I:5)
    </div>
    <div class="form-row">
        <label for="node-input-bits"><i class="fa fa-tag"></i> Bits </label>
        <input type="text" id="node-input-bits" placeholder="Bits seperated by comma,">
    </div>
</script>
<script type="text/x-red" data-help-name="revoke permission">
    <p>Revoke a specific permission for a role (or user if set by msg.targetid) on the entity/entities in payload.</p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('revoke permission', {
        category: 'api',
        color: "#F3B567",
        paletteLabel: 'revoke',
        icon: "font-awesome/fa-key",
        defaults: {
            name: { value: "" },
            targetid: { value: "" },
            entities: { value: "payload", required: true },
            bits: { value: "", required: true }
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "revoke permission";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },

        oneditprepare: function () {
            $("#node-input-typed-entities").typedInput({ types: ['msg'] });
            $("#node-input-typed-entities").typedInput('value', this.entities);


            
            try {
                $("#node-lookup-targetid").autocomplete("destroy");
            } catch (error) {
            }
            var targetidvalues = [];
            $.getJSON('api_userroles', function (data) {
                targetidvalues.push({
                    value: null,
                    label: "from msg.targetid"
                })
                $.each(data, function (i, ele) {
                    targetidvalues.push({
                        id: ele._id,
                        value: ele.name,
                        label: ele.name
                    })
                    if (ele._id == $("#node-input-targetid").val()) {
                        $("#node-lookup-targetid").val(ele.name);

                    }
                });
            });
            $("#node-lookup-targetid").focus(() => {
                $("#node-lookup-targetid").autocomplete("search", $("#node-lookup-targetid").val());
            })
            $("#node-lookup-targetid").autocomplete({
                source: targetidvalues,
                minLength: 0,
                select: function (event, ui) {
                    $("#node-input-targetid").val(ui.item.id);
                    $("#node-lookup-targetid").val(ui.item.label);
                    return false; // Prevent the widget from inserting the value.
                },
                close: function (event, ui) {
                    $.each(targetidvalues, function (i, ele) {
                        if (ele.id == $("#node-input-targetid").val()) {
                            $("#node-lookup-targetid").val(ele.label);
                        }
                    });
                },
            });

        },
        oneditsave: function () {
            $("#node-input-entities").val($("#node-input-typed-entities").typedInput('value'));
        }

    });
</script>














<script type="text/x-red" data-template-name="api updatedocument">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Query</label>
        <input type="hidden" id="node-input-querytype">
        <input style="width:70%" type="text" id="node-input-query" placeholder="Mongo Query">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Update document</label>
        <input type="hidden" id="node-input-updatedocumenttype">
        <input style="width:70%" type="text" id="node-input-updatedocument" placeholder="Update document">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Action</label>
        <select id="node-input-action">
            <option value="updateOne">updateOne</option>
            <option value="updateMany">updateMany</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Write Concern</label>
        <select id="node-input-writeconcern">
            <option value="0">Requests no acknowledgment</option>
            <option value="majority">Requests majority</option>
            <option value="1">Requests acknowledgment from 1</option>
            <option value="2">Requests acknowledgment from 2</option>
            <option value="3">Requests acknowledgment from 3</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Journal</label>
        <select id="node-input-journal">
            <option value="false">In memory</option>
            <option value="true">Written to the journal</option>
        </select>
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api updatedocument">
    <p>Send an Update document to collection ( updates parts of one or more document) 
        read more about the 
        <a tagret="_blank" href="https://docs.mongodb.com/manual/tutorial/update-documents/">
        concept here</a> and update <a tagret="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/">operators here</a>
    </p>
    <p>
        msg.action (updateOne|updateMany)<br>
        msg.query<br>
        msg.updatedocument<br>
        msg.collection<br>
        msg.writeconcern<br>
        1 - Requests acknowledgment that the write operation has propagated<br>
        0 - Requests no acknowledgment of the write operation<br>
        2 would require acknowledgment from the primary and one of the secondaries<br>
        3 would require acknowledgment from the primary and both secondaries<br>
        msg.journal<br>
        true, requests acknowledgment that the mongod instances have written to the on-disk journal<br>

    </p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api updatedocument', {
        category: 'api',
        color: "#FDF0C2",
        paletteLabel: 'updatedoc',
        icon: "font-awesome/fa-wrench",
        defaults: {
            name: { value: "" },
            writeconcern: { value: "0", required: true },
            journal: { value: "false", required: true },
            action: { value: "updateOne", required: true },
            collection: { value: "entities", validate: validate("collectiontype"), required: true },
            collectiontype: { value: "" },
            query: { value: "", validate: validate("querytype"), required: true },
            querytype: { value: "" },

            updatedocument: { value: "{ \"$inc\": { \"count\": 1}}", validate: validate("updatedocumenttype"), required: true },
            updatedocumenttype: { value: "" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api update";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-query").typedInput({
                default: 'str',
                typeField: $("#node-input-querytype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-updatedocument").typedInput({
                default: 'str',
                typeField: $("#node-input-updatedocumenttype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
        },
    });

</script>









<script type="text/x-red" data-template-name="api aggregate">
    <div class="form-row" >
        <label for="node-input-aggregates"><i class="fa fa-wrench"></i> Aggregates</label>
        <input type="hidden" id="node-input-aggregatestype">
        <input style="width:70%" type="text" id="node-input-aggregates">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="hidden" id="node-input-collectiontype">
        <input style="width:70%" type="text" id="node-input-collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api aggregate">
    <p>Send an aggregate request to an collection 
        read more about the 
        <a tagret="_blank" href="https://docs.mongodb.com/manual/reference/command/aggregate/index.html/">
            aggregate here</a> and the <a tagret="_blank" href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline//">aggregation-pipeline</a>
    </p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api aggregate', {
        category: 'api',
        color: "#3FADB5",
        paletteLabel: 'aggregate',
        icon: "font-awesome/fa-bar-chart",
        defaults: {
            name: { value: "" },
            aggregates: { value: "[ {\"$group\" : {\"_id\":\"$_type\", \"count\":{\"$sum\":1}} } ]", validate: validate("aggregatestype"), required: true },
            aggregatestype: { value: "" },

            collection: { value: "entities", validate: validate("collectiontype"), required: true },
            collectiontype: { value: "" },

        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api aggregate";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-aggregates").typedInput({
                default: 'json',
                typeField: $("#node-input-aggregatestype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-collection").typedInput({
                default: 'str',
                typeField: $("#node-input-collectiontype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
        },
    });

</script>




<script type="text/x-red" data-template-name="api download file">
<div class="form-row">
    <label><i class="fa fa-tag"></i> fileid</label>
    <input type="hidden" id="node-input-fileidtype">
    <input style="width:70%" type="text" id="node-input-fileid" placeholder="Get by database id of file">
</div>
<div class="form-row">
    <label><i class="fa fa-tag"></i> Filename</label>
    <input type="hidden" id="node-input-filenametype">
    <input style="width:70%" type="text" id="node-input-filename" placeholder="Get by filename">
</div>
<div class="form-row">
    <label><i class="fa fa-tag"></i> Result</label>
    <input type="hidden" id="node-input-resulttype">
    <input style="width:70%" type="text" id="node-input-result" placeholder="Save to">
</div>
<div class="form-row">
    <label><i class="fa fa-tag"></i> Return as buffer</label>
    <input type="checkbox" id="node-input-asbuffer" style="width: auto;">
  </div>
  <div class="form-row">
    <label><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Node name">
</div>
</script>
<script type="text/x-red" data-help-name="api download file">
Download a file from API/GridFS<br>
you can set file id using msg.fileid<br>
you can set filename using msg.filename<br>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api download file', {
        category: 'api',
        color: "#DEB887",
        paletteLabel: 'download',
        icon: "font-awesome/fa-download",
        defaults: {
            fileid: { value: "", validate: validate("fileidtype") },
            fileidtype: { value: "" },
            filename: { value: "", validate: validate("filenametype")},
            filenametype: { value: "" },
            result: { value: "payload", validate: validate("resulttype")},
            resulttype: { value: "msg" },
            asbuffer: { value: true, required: true },
            name: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api download file";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-fileid").typedInput({
                default: 'str',
                typeField: $("#node-input-fileidtype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-filename").typedInput({
                default: 'str',
                typeField: $("#node-input-filenametype"),
                types: ['msg', 'str', 'flow', 'global']
            });
            $("#node-input-result").typedInput({
                default: 'str',
                typeField: $("#node-input-resulttype"),
                types: ['msg', 'flow', 'global']
            });
        },
    });
</script>





<script type="text/x-red" data-template-name="api upload file">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Filename</label>
        <input type="hidden" id="node-input-filenametype">
        <input style="width:70%" type="text" id="node-input-filename" placeholder="filename including path">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> mimeType</label>
        <input type="hidden" id="node-input-mimeTypetype">
        <input style="width:70%" type="text" id="node-input-mimeType" placeholder="Mimetype of file">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> File Content</label>
        <input type="hidden" id="node-input-contenttype">
        <input style="width:70%" type="text" id="node-input-content" placeholder="Base64 encoded file content">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> DB Entity</label>
        <input type="hidden" id="node-input-entitytype">
        <input style="width:70%" type="text" id="node-input-entity">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Node name">
    </div>
    </script>
<script type="text/x-red" data-help-name="api upload file">
    Upload a file to API/GridFS<br>
    msg.payload should be a base64 encode string of the file.<br>
    to save data with the file set msg.metadata to and javascript object<br>
    </script>
<script type="text/javascript">
    RED.nodes.registerType('api upload file', {
        category: 'api',
        color: "#C0DEED",
        paletteLabel: 'upload',
        icon: "font-awesome/fa-upload",
        defaults: {
            filename: { value: "filename", validate: validate("filename"), required: true },
            filenametype: { value: "" },
            content: { value: "payload", validate: validate("content"), required: true },
            contenttype: { value: "" },
            mimeType: { value: "", validate: RED.validators.typedInput("mimeTypetype") },
            mimeTypetype: { value: "" },
            entity: { value: "result", validate: RED.validators.typedInput("mimeTypetype") },
            entitytype: { value: "" },
            name: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "api upload file";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-filename").typedInput({
                default: 'msg',
                typeField: $("#node-input-filenametype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-content").typedInput({
                default: 'msg',
                typeField: $("#node-input-contenttype"),
                types: ['msg']
            });
            $("#node-input-mimeType").typedInput({
                default: 'str',
                typeField: $("#node-input-mimeTypetype"),
                types: ['msg', 'str', 'flow', 'global', 'json']
            });
            $("#node-input-entity").typedInput({
                default: 'msg',
                typeField: $("#node-input-entitytype"),
                types: ['msg']
            });
        },
    });
</script>






<script type="text/x-red" data-template-name="api watch">
    <div class="form-row" style="margin-bottom: 0px;">
        <label for="node-input-aggregates"><i class="fa fa-wrench"></i> Aggregates</label>
        <input type="hidden" id="node-input-aggregates" autofocus="autofocus">
        <input type="hidden" id="node-input-noerr-aggregates">
    </div>
    <div class="form-row node-text-editor-row" style="position:relative">
        <div style="position: absolute; right:0; bottom:calc(100% + 3px);"><button id="node-function-expand-js-aggregates" class="editor-button editor-button-small"><i class="fa fa-expand"></i></button></div>
        <div style="height: 100px; min-height:100px;" class="node-text-editor" id="node-input-aggregates-editor" ></div>
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Collection</label>
        <input type="text" id="node-input-collection" placeholder="Collection">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api watch">
    <p>Watch a collection for inserts andupdates, can be filtered by aggregation pipeline (this must be prefix with fullDocument.
        read more about the 
        <a tagret="_blank" href="http://mongodb.github.io/node-mongodb-native/3.5/api//Collection.html#watch">
            watch collection here</a> and the <a tagret="_blank" href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline//">aggregation-pipeline</a>
    </p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('api watch', {
        category: 'api',
        color: "#3FADB5",
        paletteLabel: 'watch',
        icon: "font-awesome/fa-bar-chart",
        defaults: {
            name: { value: "" },
            aggregates: { value: "[\"$.[?(@._type == 'test')]\"]" },
            collection: { value: "entities" }
        },
        inputs: 0,
        outputs: 1,
        label: function () {
            return this.name || "api watch";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            this.aggregateseditor = RED.editor.createEditor({
                id: 'node-input-aggregates-editor',
                mode: 'ace/mode/json',
                value: $("#node-input-aggregates").val(),
                globals: {
                    msg: false,
                    context: false,
                    RED: false,
                    util: false,
                    flow: false,
                    global: false,
                    console: false,
                    Buffer: false,
                    setTimeout: false,
                    clearTimeout: false,
                    setInterval: false,
                    clearInterval: false
                }
            });
            const that = this;
            $("#node-function-expand-js-aggregates").click(function (e) {
                e.preventDefault();
                const value = that.aggregateseditor.getValue();
                RED.editor.editJavaScript({
                    value: value,
                    width: "Infinity",
                    cursor: that.aggregateseditor.getCursorPosition(),
                    mode: "ace/mode/json",
                    complete: function (v, cursor) {
                        that.aggregateseditor.setValue(v, -1);
                        that.aggregateseditor.gotoLine(cursor.row + 1, cursor.column, false);
                        setTimeout(function () {
                            that.aggregateseditor.focus();
                        }, 300);
                    }
                })
            });

        },
        oneditcancel: function () {
            this.aggregateseditor.destroy();
            delete this.aggregateseditor;
        },
        oneditsave: function () {
            annot = this.aggregateseditor.getSession().getAnnotations();
            $("#node-input-noerr-aggregates").val(0);
            for (let k = 0; k < annot.length; k++) {
                if (annot[k].type === "error") {
                    $("#node-input-noerr-aggregates").val(annot.length);
                    this.noerr = annot.length;
                }
            }

            $("#node-input-aggregates").val(this.aggregateseditor.getValue());
            this.aggregateseditor.destroy();
            delete this.aggregateseditor;
        }

    });

</script>







<script type="text/x-red" data-template-name="api list collections">
    <div class="form-row">
        <label><i class="fa fa-list"></i> Results</label>
        <input type="hidden" id="node-input-resultstype">
        <input style="width:70%" type="text" id="node-input-results">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api list collections">
    <p>List collections in the database <br>
    </p>
</script>
<script type="text/javascript">
    // https://fontawesome.com/v4.7/icon/list
    RED.nodes.registerType('api list collections', {
        category: 'api',
        color: "#E9967A",
        paletteLabel: 'list collections',
        icon: "font-awesome/fa-list",
        defaults: {
            name: { value: "" },
            results: { value: "payload", validate: validate("resultstype"), required: true },
            resultstype: { value: "", required: true },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "list collections";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-results").typedInput({
                default: 'msg',
                typeField: $("#node-input-resultstype"),
                types: ['msg']
            });
        }
    });
</script>


<script type="text/x-red" data-template-name="api drop collection">
    <div class="form-row">
        <label><i class="fa fa-list"></i> Collection name</label>
        <input type="hidden" id="node-input-collectionametype">
        <input style="width:70%" type="text" id="node-input-collectioname">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api drop collection">
    <p>drop collection in the database <br>
    </p>
</script>
<script type="text/javascript">
    // https://fontawesome.com/v4.7/icon/list
    RED.nodes.registerType('api drop collection', {
        category: 'api',
        color: "#E9967A",
        paletteLabel: 'drop collection',
        icon: "font-awesome/fa-list",
        defaults: {
            name: { value: "" },
            collectioname: { value: "collectionname", validate: validate("collectionametype"), required: true },
            collectionametype: { value: "msg", required: true },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "drop collection";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-collectioname").typedInput({
                default: 'msg',
                typeField: $("#node-input-collectionametype"),
                types: ['msg', 'str']
            });
        }
    });
</script>


<script type="text/x-red" data-template-name="api housekeeping">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Skip Nodered</label>
        <input type="checkbox" id="node-input-skipnodered" style="width: auto;">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Skip Calculate Size</label>
        <input type="checkbox" id="node-input-skipcalculatesize" style="width: auto;">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Skip Update User Size</label>
        <input type="checkbox" id="node-input-skipupdateusersize" style="width: auto;">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api housekeeping">
    <p>Do openflow housekeeping <br>
    </p>
</script>
<script type="text/javascript">
    // https://fontawesome.com/v4.7/icon/list
    RED.nodes.registerType('api housekeeping', {
        category: 'api',
        color: "#E9967A",
        paletteLabel: 'housekeeping',
        icon: "font-awesome/fa-list",
        defaults: {
            name: { value: "" },
            skipnodered: { value: false },
            skipcalculatesize: { value: false },
            skipupdateusersize: { value: false },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "housekeeping";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
    });
</script>


<script type="text/x-red" data-template-name="api memorydump">
    <div class="form-row">
        <label><i class="fa fa-tag"></i> NodeRED</label>
        <input type="checkbox" id="node-input-nodered" style="width: auto;">
    </div>
    <div class="form-row">
        <label><i class="fa fa-exclamation-triangle"></i> IMPORTANT</label>
        <span>This will make nodered un-responsive for at least 10 seconds</span>
    </div>    
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Openflow</label>
        <input type="checkbox" id="node-input-openflow" style="width: auto;">
    </div>
    <div class="form-row">
        <label><i class="fa fa-exclamation-triangle"></i> IMPORTANT</label>
        <span>This will make openflow un-responsive for at least 10 seconds</span>
    </div>    
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api memorydump">
    <p>Do nodered or openflow memorydump <br>
    </p>
</script>
<script type="text/javascript">
    // https://fontawesome.com/v4.7/icon/list
    RED.nodes.registerType('api memorydump', {
        category: 'api',
        color: "#E9967A",
        paletteLabel: 'memorydump',
        icon: "font-awesome/fa-list",
        defaults: {
            name: { value: "" },
            nodered: { value: true },
            openflow: { value: false },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "memorydump";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
    });
</script>

<script type="text/x-red" data-template-name="api custom">
    <div class="form-row">
        <label><i class="fa fa-list"></i> Command</label>
        <input type="hidden" id="node-input-commandtype">
        <input style="width:70%" type="text" id="node-input-command">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Payload</label>
        <input type="hidden" id="node-input-payloadtype">
        <input style="width:70%" type="text" id="node-input-payload">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Id</label>
        <input type="hidden" id="node-input-commandidtype">
        <input style="width:70%" type="text" id="node-input-commandid">
    </div>
    <div class="form-row">
        <label><i class="fa fa-list"></i> Command Name</label>
        <input type="hidden" id="node-input-commandtype">
        <input style="width:70%" type="text" id="node-input-command">
    </div>
    <div class="form-row">
        <label><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="api custom">
    <p>Do openflow custom <br>
    </p>
</script>
<script type="text/javascript">
    // https://fontawesome.com/v4.7/icon/list
    RED.nodes.registerType('api custom', {
        category: 'api',
        color: "#E9967A",
        paletteLabel: 'custom',
        icon: "font-awesome/fa-list",
        defaults: {
            name: { value: "" },
            command: { value: "command", validate: validate("commandtype"), required: true },
            commandtype: { value: "msg", required: true },
            payload: { value: "payload", validate: validate("payloadtype"), required: true },
            payloadtype: { value: "msg", required: true },
            commandid: { value: "commandid", validate: validate("commandidtype"), required: true },
            commandidtype: { value: "msg", required: true },
            command: { value: "command", validate: validate("commandtype"), required: true },
            commandtype: { value: "msg", required: true },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "custom";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-command").typedInput({
                default: 'msg',
                typeField: $("#node-input-commandtype"),
                types: ['msg', 'str']
            });
            $("#node-input-payload").typedInput({
                default: 'msg',
                typeField: $("#node-input-payloadtype"),
                types: ['msg', 'str']
            });
            $("#node-input-commandid").typedInput({
                default: 'msg',
                typeField: $("#node-input-commandidtype"),
                types: ['msg', 'str']
            });
            $("#node-input-command").typedInput({
                default: 'msg',
                typeField: $("#node-input-commandtype"),
                types: ['msg', 'str']
            });
        }

    });
</script>